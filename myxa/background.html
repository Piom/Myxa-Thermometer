<script>
	var Therm = 0;
	function refreshIcon(Therm) {
		Therm = parseFloat(Therm) > 0 ? '+' + Therm : '-' + Therm;
		chrome.browserAction.setBadgeText({
			text : String(Therm)
		});
		if (parseFloat(Therm) > 0) {
			chrome.browserAction.setBadgeBackgroundColor({
				color : [ 255, 0, 0, 255 ]
			});
		} else {
			chrome.browserAction.setBadgeBackgroundColor({
				color : [ 0, 0, 255, 255 ]
			});
		}
		var d = new Date();
		chrome.browserAction.setTitle({title:chrome.i18n.getMessage("last_update")+ d.toLocaleString()});
	}
	function getValue() {
		var xhr = new XMLHttpRequest();
		xhr.open("GET", "http://dove.omsk.otpbank.ru/files/weather.js", true);
		xhr.onreadystatechange = function() {
			if (xhr.readyState == 4) {
				eval(xhr.responseText);
				if(typeof Therm != 'undefined'){
					refreshIcon(Therm);
				}
			}
		}
		xhr.send();
	}
	window.onload = function() {
		getValue();
		setInterval('getValue()', 60000);
	}
</script>

